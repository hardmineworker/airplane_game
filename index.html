<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>블럭 피하기 게임</title>
    <style>
      body {
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #explain {
        position: absolute;
        top: 200px;
        left: 180px;
      }

      #mycanvas {
        border: 3px solid black;
      }

      #one {
        position: absolute;
        top: 75px;
        left: 975px;
        background-color: black;
        width: 100px;
        height: 50px;
      }

      #start {
        position: absolute;
        top: 150px;
        left: 380px;
        width: 100px;
        height: 50px;
      }

      #change {
        position: absolute;
        top: 210px;
        left: 380px;
        width: 100px;
        height: 50px;
      }

      #display {
        position: absolute;
        top: 100px;
        left: 1000px;
        width: 100px;
        height: 50px;
      }
    </style>
    <script>
      window.onload = function () {
        var images = [];
        function preload() {
          for (var i = 0; i < arguments.length; i++) {
            images[i] = new Image();
            images[i].src = preload.arguments[i];
          }
        }
        preload("./airplane.jpg");
        //함수---------------------------------------------------------
        //sleep-------------------------------------------------------
        function sleep(ms) {
          const wakeUpTime = Date.now() + ms;
          while (Date.now() < wakeUpTime) {}
        }
        //시간 시작 함수-----------------------------------------------
        function start() {
          startButton.onclick = null;
          startTime = new Date();
          timer = setInterval(function () {
            var now = new Date();
            display.innerHTML = ((now - startTime) / 1000).toFixed(2);
          }, 10);
        }
        //시간 정지 함수---------------------------------------------
        function stop() {
          clearInterval(timer);
          startButton.onclick = start;
        }
        // 작아지는 함수--------------------------------------------
        function small_f() {
          box.wdith = 10;
          box.height = 10;
        }
        // 커지는 함수--------------------------------------------
        function big() {
          box.wdith = 20;
          box.height = 20;
        }
        // 속도를 늦추는 함수--------------------------------------------
        function speed_down() {
          box.speed = 1.6;
          speed = false;
        }

        //눌렀을때 키값-------------------------------------
        function Pkey(e) {
          if (e.keyCode === 37 && box.x >= 0) {
            Left = true;
          } else if (e.keyCode === 38 && box.y + box.height >= 0) {
            Up = true;
          } else if (e.keyCode === 39 && box.x <= 500) {
            Right = true;
          } else if (e.keyCode === 40 && box.y <= 500) {
            Down = true;
          } else if (e.keyCode === 90) {
            if (game_start == true) {
              if (speed == true) {
                speed = false;
                item.speed_Up();
              }
            }
          } else if (e.keyCode === 88) {
            if (game_start == true) {
              if (small == true) {
                small == false;
                item.small();
              }
            }
          } else if (e.keyCode === 67) {
            if (game_start == true) {
              if (k == true) {
                if (move_stop == true) {
                  move_stop = false;
                  k = false;
                  item.move();
                }
              }
            }
          } else if (e.keyCode === 82) {
            if (game_start == false) {
              game_start = true;
              game_start1();
            }
          } else if (e.keyCode === 84) {
            if (game_start == false) {
              game_start = true;
              game_start2();
            }
          }
        }

        //뗐을때 키값--------------------------------------
        function Ukey(e) {
          if (e.keyCode === 37) {
            Left = false;
          } else if (e.keyCode === 38) {
            Up = false;
          } else if (e.keyCode === 39) {
            Right = false;
          } else if (e.keyCode === 40) {
            Down = false;
          } else if (e.keyCode === 90) {
            speed_Up = false;
          } else if (e.keyCode === 88) {
            small = false;
          }
        }

        //게임을 시작하는 함수-------------------------------------
        function game_start1() {
          start();
          var g = setInterval(game1, 0.1);
        }
        //두번째 게임을 시작하는 함수--------------------------------------
        function game_start2() {
          start();
          var g = setInterval(game2, 0.1);
        }

        //블록에 닿았을 때 실행되는 함수--------------------------------------------
        function touch(block) {
          if (touching == false) {
            if (
              box.x + box.wdith >= block.x &&
              box.x <= block.x + block.wdith &&
              y - box.y >= block.y &&
              y - (box.y + box.height) <= block.y + block.height
            ) {
              touching = true;
            }
          } else if (touching == true) {
            stop();
            game_start = false;
            location.reload();
            confirm("끝! 다시시작하기");
            event.preventDefault();
          }
        }

        function block_cheak(block) {}

        //box가 움직이는 함수---------------------------------------
        function box_start() {
          if (box.x < 0) {
            box.x = 0;
          } else if (box.x > 300 - box.wdith) {
            box.x = 300 - box.wdith;
          } else if (y - box.y > 500) {
            box.y = 0;
          } else if (y - (box.y + box.height) < 0) {
            box.y = y - (box.y + box.height);
          }
          if (Left == true) {
            box.x -= box.speed;
          } else if (Right == true) {
            box.x += box.speed;
          } else if (Up == true) {
            box.y += box.speed;
          } else if (Down == true) {
            box.y -= box.speed;
          }
          draw();
          touch(block1);
          touch(block2);
          touch(block3);
          touch(block4);
          touch(block5);
          touch(block6);
          touch(R_block1);
          touch(R_block2);
          touch(R_block3);
          touch(R_block4);
          touch(R_block5);
          touch(R_block6);
          touch(L_block1);
          touch(L_block2);
          touch(L_block3);
          touch(L_block4);
          touch(L_block5);
          touch(L_block6);
        }

        //box를 그리는 함수------------------------------------------------------------
        function draw() {
          ctx.beginPath();
          ctx.drawImage(
            images[0],
            box.x - box.wdith / 2,
            y - (box.y + box.height + (box.height * 1) / 2),
            box.wdith * 2,
            box.height * 2
          );
          ctx.closePath();
        }
        //block이 움직이는 함수--------------------------------------------------
        function block_Fmove(block, x) {
          if (block.y >= 500 + block.height) {
            block.y = Math.random() * -500;
            block.speed = block.fullspeed;
            if (block.fullspeed <= x) {
              block.fullspeed += 0.1;
              block.wdith = Math.random() * 20 + 10;
              block.height = Math.random() * 20 + 10;
            }
            block.x = Math.floor(Math.random() * 300 - block.wdith);
          }
          ctx.lineWidth = 1;
          ctx.fillStyle = "red";
          ctx.fillRect(block.x, block.y, block.wdith, block.height);
          if (move_stop == true) {
            block.y += block.speed;
          }
        }
        //block이 오른쪽으로 움직이는 함수--------------------------------------
        function block_Rmove(block, x) {
          if (block.x >= 300 + block.wdith) {
            block.x = Math.random() * -300;
            block.speed = block.fullspeed;
            if (block.fullspeed <= x) {
              block.fullspeed += 0.1;
              block.wdith = Math.random() * 20 + 10;
              block.height = Math.random() * 20 + 10;
            }
            block.y = Math.floor(Math.random() * 500 - block.wdith);
          }
          ctx.lineWidth = 1;
          ctx.fillStyle = "red";
          ctx.fillRect(block.x, block.y, block.wdith, block.height);
          if (move_stop == true) {
            block.x += block.speed;
          }
        }
        //block이 왼쪽으로 움직이는 함수-------------------------------------------
        function block_Lmove(block, x) {
          if (block.x <= -(300 + block.wdith)) {
            block.x = Math.random() * 300 + 300;
            block.speed = block.fullspeed;
            if (block.fullspeed <= x) {
              block.fullspeed += 0.1;
              block.wdith = Math.random() * 20 + 10;
              block.height = Math.random() * 20 + 10;
            }
            block.y = Math.floor(Math.random() * 500 - block.wdith);
          }
          ctx.lineWidth = 1;
          ctx.fillStyle = "red";
          ctx.fillRect(block.x, block.y, block.wdith, block.height);
          if (move_stop == true) {
            block.x -= block.speed;
          }
        }
        //block를 만드는 함수----------------------------------------------------------
        function blockMaker() {
          (this.x = Math.floor(Math.random() * 150 + 150)),
            (this.y = Math.random() * -100),
            (this.height = Math.random() * 20 + 10),
            (this.wdith = Math.random() * 20 + 10),
            (this.speed = 1),
            (this.fullspeed = 2);
        }
        //-----------------------------------------------------------------
        function R_blockMaker() {
          (this.x = Math.floor(Math.random() * -150 - 150)),
            (this.y = Math.random() * 500),
            (this.height = Math.random() * 20 + 10),
            (this.wdith = Math.random() * 20 + 10),
            (this.speed = 1),
            (this.fullspeed = 2);
        }
        //------------------------------------------------------
        function L_blockMaker() {
          (this.x = Math.floor(Math.random() * 150 + 350)),
            (this.y = Math.random() * 500),
            (this.height = Math.random() * 20 + 10),
            (this.wdith = Math.random() * 20 + 10),
            (this.speed = 1),
            (this.fullspeed = 2);
        }
        //변수------------------------------------------------
        var Left,
          Right,
          Up,
          Down,
          move_stop = true,
          k = true;
        //캔버스----------------------------------------------
        var canvas = document.getElementById("mycanvas");
        var ctx = canvas.getContext("2d");
        //상자 객체------------------------------------------------
        var box = {
          height: 20,
          wdith: 20,
          x: 150,
          y: 250,
          speed: 1.6,
        };
        //아이템 객체-----------------------------------------
        var item = {
          speed_Up: function () {
            box.speed = 3;
            setTimeout(function () {
              speed_down();
              setTimeout(function () {
                speed = true;
              }, 3000);
            }, 3000);
          },
          small: function () {
            small_f();
            setTimeout(function () {
              big();
              setTimeout(function () {
                small = true;
              }, 3000);
            }, 3000);
          },
          move: function () {
            setTimeout(function () {
              move_stop = true;
              setTimeout(function () {
                k = true;
              }, 5000);
            }, 3000);
          },
        };
        //좌표----------------------------------------------

        var x = 0;
        var y = 500;

        function game1() {
          ctx.clearRect(0, 0, 300, 500);
          block_Fmove(block1, 6);
          block_Fmove(block2, 6);
          block_Fmove(block3, 6);
          block_Fmove(block4, 6);
          block_Fmove(block5, 6);
          block_Fmove(block6, 6);
          box_start();
        }

        function game2() {
          ctx.clearRect(0, 0, 300, 500);
          block_Rmove(R_block1,6);
          block_Rmove(R_block2,6);
          block_Lmove(L_block1,6);
          block_Lmove(L_block2,6);
          block_Fmove(block1, 6);
          block_Fmove(block2, 6);
          box_start();
        }

        //블록생성------------------------------------------------
        var block1 = new blockMaker();
        var block2 = new blockMaker();
        var block3 = new blockMaker();
        var block4 = new blockMaker();
        var block5 = new blockMaker();
        var block6 = new blockMaker();
        var R_block1 = new R_blockMaker();
        var R_block2 = new R_blockMaker();
        var R_block3 = new R_blockMaker();
        var R_block4 = new R_blockMaker();
        var R_block5 = new R_blockMaker();
        var R_block6 = new R_blockMaker();
        var L_block1 = new L_blockMaker();
        var L_block2 = new L_blockMaker();
        var L_block3 = new L_blockMaker();
        var L_block4 = new L_blockMaker();
        var L_block5 = new L_blockMaker();
        var L_block6 = new L_blockMaker();
        //아이템 변수----------------------------------------------
        var speed_Up = false;
        var small = true;
        var speed = true;
        var size_z = 0;
        var game_start = false;

        //물체에 닿았는지 확인하는 변수--------------------------------------
        var touching = false;
        //document에서 값 받아오는 변수------------------------------------
        var startButton = document.getElementById("start");
        var changeButton = document.getElementById("change");
        var display = document.getElementById("display");
        //버툰 클릭--------------------------------------------------------------

        startButton.onclick = function () {
          if (game_start == false) {
            game_start = true;
            game_start1();
          }
        };

        changeButton.onclick = function () {
          if (game_start == false) {
            game_start = true;
            game_start2();
          }
        };

        //------------------------------------------------
        startButton;
        //키 값 받기---------------------------------------------
        document.addEventListener("keydown", Pkey, false);
        document.addEventListener("keyup", Ukey, false);

        //---------------------------------------------------------------------
      };
    </script>
  </head>
  <body>
    <p id="explain">
      r은 첫번쨰 게임시작
      <br />
      t은 두번쨰 게임시작
      <br />
      z는 속도 증가 3초 쿨 3초
      <br />
      x는 축소 3초 쿨 3초
      <br />
      c는 블록정지 3초 쿨 5초
    </p>
    <br />
    <p id="one"></p>
    <p>
      <span
        id="display"
        style="
          font-weight: bold;
          font-size: 1.5em;
          line-height: 1em;
          color: rgb(0, 255, 21);
          font-family: arial;
        "
      >
        0.00
      </span>
    </p>
    <input id="start" type="button" value="1.start" />
    <input id="change" type="button" value="2.start" />
    <canvas id="mycanvas" height="500;" weight="500"></canvas>
  </body>
</html>
